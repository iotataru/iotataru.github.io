<!DOCTYPE html>
<html>
<head>
    <title>Dialog App - Parent Page</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/beta/hosted/office.debug.js"></script> 
</head>

   	<script type="text/javascript">
		"use strict";
		// The initialize function must be run each time a new page is loaded
		var _dialog;
		var _childPageUrl = "https://iotataru.github.io/DialogApi/ChildPage.html";

		function showNotification(text) {
		    document.getElementById('actionResult').innerText += text;
		}

		function launchDialogCallback(arg) {
		    if (arg.status === "failed") {
		        showNotification("launch dialog failed");
		    }
		    else {
		        _dialog = arg.value;
		        _dialog.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogMessageReceived, addMessageStatus);
		        _dialog.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogEventReceived, addCloseStatus);
			setTimeout(messageChildInitial, 2000);
		    }
		}

		function addMessageStatus(arg) {
		    showNotification(arg.message);
		}

		function addCloseStatus(arg) {
		    showNotification("dialog closed");
		}

		function launchInlineDialog() {
		    var dialogUrl = !!(document.getElementById("InlineLaunch").value) ? document.getElementById("InlineLaunch").value : _childPageUrl;
		    Office.context.ui.displayDialogAsync(dialogUrl,
			{height:80, width:50, requireHTTPS: false, hideTitle: true, requireHTTPs: false, promptBeforeOpen:false, enforceAppDomain: false, displayInIframe:true},
			launchDialogCallback);
		}

		function launchWindowDialog() {
		    var dialogUrl = !!(document.getElementById("WindowLaunch").value) ? document.getElementById("WindowLaunch").value : _childPageUrl;
		    Office.context.ui.displayDialogAsync(dialogUrl,
			{height:80, width:50, requireHTTPS: false, hideTitle: true, requireHTTPs: false, promptBeforeOpen:false, enforceAppDomain: false},
			launchDialogCallback);
		}

		function launchInlineDialogFromRibbon(args) {
		    Office.context.ui.displayDialogAsync(_childPageUrl, { height: 50, width: 30, displayInIframe: true }, launchDialogCallback);

		    args.completed();
		}

		function launchWindowDialogFromRibbon(args) {
		    Office.context.ui.displayDialogAsync(_childPageUrl, { height: 50, width: 30, displayInIframe: false }, launchDialogCallback);

		    args.completed();
		}
		
		function messageChildInitial() {
		    messageChild("Initial message for child upon parent's launchDialogCallback");
		}

		function messageChild(message = "") {
		    var value = document.getElementById("MessageForChild").value;
		    if (!value) {
			value = message;
			if (!value) {
			    value = "Message For Child";
			}
		    }

		    _dialog.messageChild(value);
		}

		function closeDialog() {
		    _dialog.close();
		}

		function redirect() {
		    var value = document.getElementById("RedirectWebsite").value;
		    if (!value) {
		        console.log("Error: need a website in the textbox.");
		        return;
		    }
		    window.location.href = value;
		}
	</script>
	<script>
		// Perform Step 2 of an initialization that -- in a real developer scenario (non-test-agave), would have
		//    been included inside the "excel-web-16.00.js"/"excel-win32-16.01.js"/etc files
		Office.onReady(function(info) {
			// do something
		});
	</script>
	<body>
		<div id="content-header">
	        <div class="padding">
	            <h1>Dialog App - Parent Page</h1>
	        </div>
	    </div>
	    <div id="content-main" style="background-color:#F08080;">
	        <div class="padding">
	            <button id="launchInlineDialog" onclick="launchInlineDialog()">Launch Inline Dialog</button>: <input id="InlineLaunch" type="text" placeholder="https://iotataru.github.io/DialogApi/ChildPage.html" style="width:300px;"/>
	            <p></p>
	            <button id="launchWindowDialog" onclick="launchWindowDialog()">Launch Window Dialog</button>: <input id="WindowLaunch" type="text" placeholder="https://iotataru.github.io/DialogApi/ChildPage.html" style="width:300px;"/>
	            <p></p>
	            <button id="messageChild" onclick="messageChild()">SendMessageToChild</button>: <input id="MessageForChild" type="text" placeholder="Message For Child" style="width:200px;"/>
	            <p></p>
	            <button id="redirect" onclick="redirect()">Redirect</button>: <input id="RedirectWebsite" type="text" placeholder="https://someWebsiteToRedirectTo.com" style="width:300px;"/>
	            <p></p>
	            <label id="actionResult"></label>
	            <div> Source: https://iotataru.github.io/DialogApi/ParentPage.html </div>
	        </div>
	    </div>
	</body>
</html>
